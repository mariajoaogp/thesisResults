class BlockerHandler{constructor(e){this.store=e,this.whiteList=["google.com","youtube.com"],this.closeMessage=this.closeMessage.bind(this)}showMessage(){ReactDOM.render(React.createElement("div",{style:{opacity:1},className:"wot-block-container"},React.createElement("div",{className:"wot-block-header"},React.createElement("div",{className:"wot-block-header-part"},React.createElement("div",{className:"wot-block-icon"}),React.createElement("div",{className:"wot-block-text"},webextApi.i18n.getMessage("popupBlocked"))),React.createElement("div",{className:"wot-block-header-part"},React.createElement("div",{className:"wot-block-hide",title:"Close this time",onClick:this.notShowNotification.bind(this)}),React.createElement("div",{className:"wot-block-close",onClick:()=>this.closeMessage(!0)}))),React.createElement("div",{className:"wot-block-action"},React.createElement("div",{className:"wot-block-once",onClick:this.showOnce.bind(this)},webextApi.i18n.getMessage("AllowOnce")),React.createElement("div",{className:"wot-block-always",onClick:this.addToWhitelist.bind(this)},webextApi.i18n.getMessage("AllowAlways")))),document.getElementById(WOT_PP_CONTAINER))}showOnce(){window.postMessage({type:"wotNotBlocked"},"*"),this.closeMessage(!0)}notShowNotification(){this.store.dispatch(turnOffPopupBlockNotification()),this.closeMessage(!0)}addToWhitelist(){this.showOnce(),this.store.dispatch(addToWhitelist(this.host)),this.closeMessage(!0)}closeMessage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(clearTimeout(this.timeout),e)return document.getElementById(WOT_PP_CONTAINER).innerHTML="",void 0;const t=document.getElementsByClassName("wot-block-container"),s=t&&t[0];s&&(s.style.opacity="0",s.style["-webkit-animation"]="fadeOut 350ms",s.style.animation="fadeOut 350ms",setTimeout(()=>{document.getElementById(WOT_PP_CONTAINER).innerHTML=""},350))}init(){var e=this.store.getState();const t=e.whitelist,s=e.settings,o=e.user;if(!o||!o.isPremiumUser||!s.blockPopUp)return;this.host=getEncodedDomain(window.location.href);if(!this.host||this.whiteList.some(e=>this.host.indexOf(e)>-1))return;this.code=`(function () {\n          var wot_wl = ${JSON.stringify(t)};\n          var host = '${this.host}';\n          function ${this.blocker.toString()};\n          blocker();\n        })();`,addEventListener("message",e=>{const t=e.data;if(t&&"wotBlocked"===t.type){this.store.getState().settings.blockPopUpNotification&&(this.showMessage(),this.timeout=setTimeout(()=>{this.closeMessage()},5e3)),webextApi.runtime.sendMessage({name:POP_BLOCKED,host:this.host})}});const i=document.createElement("span");i.id=WOT_PP_CONTAINER,document.body.appendChild(i);const n=document.createElement("script");n.textContent=this.code,this.insertScript(n),n.remove()}blocker(){const e=document.createElement;let t,s=0;const o=window.parent;let i=!0;function n(){return-1!==wot_wl.indexOf(host)}function c(){(!t||t<Date.now()-1e3)&&o.postMessage({type:"wotBlocked"},"*"),t=Date.now()}addEventListener("message",e=>{const t=e.data;t&&"wotNotBlocked"===t.type&&(i=!1)}),document.createElement=function(t){const o=e.apply(document,arguments);if(t&&"a"===t.toLowerCase()){s=(new Date).getTime();const e=o.click;o.click=function(){if(i&&!n())return c(),void 0;for(var t=arguments.length,s=Array(t),o=0;o<t;o++)s[o]=arguments[o];e.apply(this,s)}}return o}}insertScript(e){const t=document.head;if(t)return t.appendChild(e);const s=document.documentElement;s.insertBefore(e,s.firstChild)}}