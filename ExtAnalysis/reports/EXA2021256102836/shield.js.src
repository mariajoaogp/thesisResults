const mobileWidth=450;class ShieldComponent extends React.Component{constructor(e){super(e),this.immediateClearPopup.bind(this),window.addEventListener("scroll",e=>{0!==this.props.info.onboarding.step&&this.immediateClearPopup()}),window.addEventListener("onclick",e=>{if(!e.target.classList.contains("wot_shield")){document.querySelector("."+POPUP_OVERLAY).classList.contains("wot-open")&&this.immediateClearPopup()}}),this.state={isPopupOpen:!1},this.showFirstTooltip=_.once(this.showFirstTooltip.bind(this)),this.onShieldOver=this.onShieldOver.bind(this),this.clearPopup=this.clearPopup.bind(this),this.onLogoClick=this.onLogoClick.bind(this),this.onLinkClick=this.onLinkClick.bind(this),this.onSettingsClick=this.onSettingsClick.bind(this),this.immediateClearPopup=this.immediateClearPopup.bind(this)}desktopPopup(e){let t=e.info,o=e.isOnboarding,i=e.styles;const s=setInterval(()=>{const e=document.getElementById("wot-popup-body");e&&(e.style.opacity=1,clearInterval(s))},50);return React.createElement("div",{style:i,onMouseLeave:this.clearPopup},React.createElement("div",{className:"shield__popover_container"},o&&t.onboarding.step<5&&React.createElement(ShieldOnBoarding,{closePopup:this.immediateClearPopup,safety:t.safety,childSafety:t.childSafety,color:this.props.info.shieldColor,onboarding:t.onboarding,dispatch:this.props.dispatch}),this.popupBody(t)))}mobilePopup(e){let t=e.info;return document.querySelector("."+POPUP_OVERLAY).classList.add("wot-open"),React.createElement("div",{className:"shield__popover_container",onMouseLeave:this.clearPopup},React.createElement("div",{className:"wot-mobile_popup"},this.popupBody(t,!0)))}getPopupHeaderText(e){switch(e){case SAFE:return"trustedByWOT";case SUSPICIOUS:return"suspiciousByWOTPopup";case NOT_SAFE:return"untrustedByWOTPopup";case UNKNOWN:default:return"unknownByWOTPopup"}}getHeaderClass(e){switch(e){case SAFE:return"shield__header_safe";case SUSPICIOUS:return"shield__header_suspicious";case NOT_SAFE:return"shield__header_unsafe";case UNKNOWN:default:return"shield__header_unknown"}}popupBody(e){const t=e.categories,o=e.safety,i=e.childSafety;return React.createElement("div",{id:"wot-popup-body",className:"shield__popover"+(i===NOT_SAFE?" adult":"")},React.createElement("div",{className:"shield__header "+this.getHeaderClass(o)},React.createElement("span",null,translate(this.getPopupHeaderText(o))),React.createElement(SvgIcon,{className:"shield__header__icon",svg:"question_mark.svg",onClick:this.onInfoClick}),React.createElement(SvgIcon,{className:"shield__header__icon settings",svg:"settings-wheel.svg",onClick:this.onSettingsClick})),i===NOT_SAFE&&React.createElement("div",{className:"child-label"},React.createElement(SvgIcon,{className:"child-label_icon",svg:"18+red.svg"}),React.createElement("div",null,translate("popupAdultStrip"))),React.createElement("div",{className:"shield__body"},React.createElement(ScorecardData,{info:e}),React.createElement("div",{className:"shield__body_separator"}),t&&t.length?React.createElement("div",{style:{width:"100%"}},React.createElement(TargetTags,{categories:t}),React.createElement("div",{className:"shield__body_separator"})):null),React.createElement("div",{className:"shield__footer"},React.createElement("a",{className:"shield__viewaway",onClick:this.onLinkClick},translate("viewFullScorecard"),React.createElement(SvgIcon,{className:"shield__open-in-new",svg:"open-in-new.svg"})),React.createElement(SvgIcon,{className:"shield__logo",svg:"logo-bw.svg",onClick:this.onLogoClick})))}showPopup(e){var t=this.props;const o=t.info,i=t.store,s=t.isOnboarding,n=this.isMobileView()?this.mobilePopup({info:o}):this.desktopPopup({info:o,isOnboarding:s,styles:e});ReactDOM.render(React.createElement(ReactRedux.Provider,{store:i},React.createElement("div",null,{...n})),document.querySelector("."+POPUP_CONTAINER))}removePopup(){const e=document.querySelector("."+POPUP_CONTAINER);e&&(e.innerHTML="")}showFirstTooltip(e){var t=this.props;const o=t.info,i=t.store;ReactDOM.render(React.createElement(ReactRedux.Provider,{store:i},React.createElement("div",{style:e},React.createElement(ShieldOnBoarding,{closePopup:this.immediateClearPopup,shieldColor:o.shieldColor,safety:o.safety,color:this.props.info.shieldColor,onboarding:o.onboarding,dispatch:this.props.dispatch}))),document.querySelector("."+POPUP_CONTAINER))}isMobileView(){return window.innerWidth<=450||window.innerHeight<=450}fixPopupOverflow(e){const t=document.body.offsetWidth;return e+320>t&&(e=t-320),e}getPopupPositioning(e){if(this.isMobileView())return;const t=this.props.isOnboarding&&this.props.info.onboarding.step<5;var o=this.getPosition(e.currentTarget);const i=o.left,s=o.top;return{position:t?"absolute":"fixed",left:(t?i-4:this.fixPopupOverflow(i))+"px",top:s+"px",zIndex:"2147483646"}}onShieldOver(e){this.immediateClearPopup(),this.setState({isPopupOpen:!0}),this.props.isOnboarding&&0===this.props.info.onboarding.step&&(this.props.dispatch(toNextStepOnboarding()),this.props.info.onboarding.step=1),GA("Search Popup","Shown "+this.props.info.shieldColor,this.props.info.host),this.showPopup(this.getPopupPositioning(e))}clearPopup(){this.props.isOnboarding&&this.props.info.onboarding.step<5||this.immediateClearPopup()}immediateClearPopup(){this.setState({isPopupOpen:!1});document.querySelector("."+POPUP_OVERLAY).classList.remove("wot-open"),document.querySelector("."+POPUP_CONTAINER).innerHTML=""}onLinkClick(){webextApi.runtime.sendMessage({name:OPEN_TAB_MESSAGE,url:FULL_REPORT_URL+this.props.info.host+"?utm_source=addon&utm_content=search_shield"}),GA("Search Popup","Full Scorecard "+this.props.info.shieldColor,this.props.info.host)}onLogoClick(){GA("Search Popup","WOT Logo "+this.props.info.shieldColor,this.props.info.host),webextApi.runtime.sendMessage({name:OPEN_TAB_MESSAGE,url:MAIN_PAGE_URL+"?utm_source=addon&utm_content=search_shield"})}onSettingsClick(){GA("Search Popup","Settings "+(this.props.info.shieldColor.charAt(0).toUpperCase()+this.props.info.shieldColor.substr(1).toLowerCase()),getEncodedDomain(location.href)),webextApi.runtime.sendMessage({name:OPEN_TAB_MESSAGE,url:`${OPTIONS_URL}?serpid=${this.props.serpid}`})}onInfoClick(){GA("Search Popup","Learn More"),webextApi.runtime.sendMessage({name:OPEN_TAB_MESSAGE,url:LEARN_MORE_URL})}componentDidUpdate(){if(this.isMobileView()||!this.props.isOnboarding||0!==this.props.info.onboarding.step)return;let e;const t=Array.from(document.querySelectorAll(".wot_shield:not(.shield_gray)")).find(t=>(e=this.getPosition(t),e.top>14));e&&t&&this.showFirstTooltip({position:"absolute",left:e.left+23+"px",top:e.top-14+"px",zIndex:"2147483646"})}getPosition(e){"string"==typeof e&&(e=document.querySelector(e));var t=this.props;const o=t.isOnboarding,i=t.info,s=e.getBoundingClientRect();let n=s.top,r=s.left;if(o&&i.onboarding.step<5){const e=document.body.getBoundingClientRect();n-=e.top,r-=e.left}return{top:n,left:r}}render(){var e=this.props;const t=e.info,o=e.containerSelector,i=e.showAdultExtraIcon;var s=e.style;const n=void 0===s?{}:s;var r=e.additionalContainerStyle;const a=void 0===r?{}:r,l=t.childSafety===NOT_SAFE&&i&&t.settings.parentalExtraIcon,c=document.querySelector(o);return"invisible"!==t.shieldColor&&t.settings.protection?(c&&(c.style.width="16px",c.style.height="16px"),c&&l&&Object.assign(c.style,a),React.createElement("div",{className:"shield_container",onMouseEnter:this.onShieldOver,onTouchStart:this.onShieldOver},React.createElement("div",{ref:e=>{this.shieldEl=e},className:`wot_shield shield shield_${t.shieldColor} ${this.state.isPopupOpen?"popup_open":""}`,style:n}),l&&React.createElement(SvgIcon,{className:"adult_content_indicator_gray",svg:"18+gray.svg"}))):(c&&(c.style.width=0,c.style.height=0),this.removePopup(),React.createElement("div",null))}}function mapStateToPros(e,t){t=this&&this.props||t;const o=getEncodedDomain(t.target);let i=e.settings.shields.all;const s={info:{host:o,shieldColor:"invisible",bubbleColor:"gray",safety:UNKNOWN,childSafety:100,rating:-1,confidence:0,onboarding:{},settings:e.settings}};for(const o in e.settings.shields)t.serpid===o&&(i=e.settings.shields[o]);if(void 0===this||i===SHIELDS_LEVEL_OFF)return s;if(e.ratings[o]){var n=e.ratings[o];const t=n.rating,r=n.confidence,a=n.safety;const l=getShieldColor(e.ratings[o]).color;s.info={host:o,shieldColor:i===SHIELDS_LEVEL_NORMAL&&["gray","green"].indexOf(l)>=0?"invisible":l,bubbleColor:e.ratings[o].color,categories:e.ratings[o].categories||[],safety:a,childSafety:e.ratings[o].childSafety,commentsCount:e.ratings[o].commentsCount,rating:t,confidence:r,onboarding:e.onboarding,settings:e.settings}}return s}ShieldComponent.propTypes={target:React.PropTypes.string.isRequired},mapStateToPros.dependsOnOwnProps=!0,ShieldComponent=ReactRedux.connect(mapStateToPros)(ShieldComponent);