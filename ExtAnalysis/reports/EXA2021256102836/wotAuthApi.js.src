class _WotAuthApi{constructor(){this.root="https://auth.api.mywot.com"}post(e,s,t){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};"function"==typeof t&&(o=t,t=void 0);const n=new XMLHttpRequest,r=+new Date;n.open("POST",e),n.setRequestHeader("Content-Type","application/json"),t&&Object.keys(t).forEach(e=>{n.setRequestHeader(e,t[e])}),n.onload=()=>(n.time=+new Date-r,o.call(null,n)),n.send(JSON.stringify(s))}get(e,s,t){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};"function"==typeof t&&(o=t,t={});const n=new XMLHttpRequest,r=+new Date;n.open("get",e+(-1!==e.indexOf("?")?"":"?")+Object.keys(s).map(e=>`${e}=${encodeURIComponent(s[e])}`).join("&"));for(const e in t)n.setRequestHeader(e,t[e]);n.onload=()=>(n.time=+new Date-r,o.call(null,n)),n.send()}getUser(e){const s=this.root+"/me";return new Promise((t,o)=>{this.get(s,"",{Authorization:"Bearer "+e,"Content-Type":"text/plain"},e=>{if(200===e.status){let s;try{s=JSON.parse(e.responseText)}catch(e){s={code:4006,message:"You've been logged out. Please login again"}}const o=s.score&&parseStatus(s.score);!s.roles[6]&&o&&(s.roles[6]=o),s.roles[7]?s.roles[6]=s.roles[7]:s.roles[8]?s.roles[6]=s.roles[8]:s.roles[9]?s.roles[6]=s.roles[9]:s.roles[10]&&(s.roles[6]=s.roles[10]),t(s)}else o({code:e.status,message:"Cannot get user info"})})})}login(e,s){const t="object"==typeof e?e:{username:e,password:s},o=this.root+"/token?";return new Promise((e,s)=>{this.post(o,t,t=>{const o=JSON.parse(t.responseText);if(200===t.status){const s=o.token;e(s)}else s({code:o.code,message:o.message})})})}logout(e){return new Promise((s,t)=>{if(!e)return Promise.resolve();const o=this.root+"/logout",n={Authorization:"Bearer "+(e||"")};this.post(o,{},n,o=>{200===o.status?s(e):t(o.status)})})}register(e,s,t,o){const n="object"==typeof e?e:{name:e,mail:s,pass:t,Pass2:o},r=this.root+"/signup?";return new Promise((e,s)=>{this.post(r,_.merge({},n,{Pass2:n.Pass2||n.pass}),t=>{const o=JSON.parse(t.responseText);if(200===t.status){400===o.status&&s({code:o.code,message:o.message});const t=o.token;e(t)}else s({code:o.code,message:o.message})})})}forgot(e){const s="object"==typeof e?e:{username:e},t=this.root+"/forgot-pass?";return new Promise((e,o)=>{this.post(t,_.merge({},s),s=>{const t=JSON.parse(s.responseText);200===s.status?e(t):o({code:t.code,message:t.message})})})}socialLoginUrl(e){return`${this.root}/${e}?source=extension`}}const WotAuthApi=new _WotAuthApi;