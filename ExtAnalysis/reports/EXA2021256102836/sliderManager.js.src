class SliderManager{constructor(t){this.store=t,this.container=null,this.hideTimeOutRef=null,this.showTimeOutRef=null,this.isSliderOpen=!1,this.hightlightSection=""}init(){if("true"===document.body.getAttribute("wotDisconnected"))return webextApi.runtime.sendMessage({name:CONTENT_DISCONNECTED}),void 0;webextApi.runtime.onMessage.addListener((t,e,i)=>{const n=t.action,s=t.section;if(n===TOGGLE_WOT_SLIDER){if(i(TOGGLE_WOT_SLIDER),this.isSliderOpen)return this.hide();this.container=document.getElementById(WOT_POPUP_SLIDER_IFRAME),this.container&&s===this.hightlightSection||(this.container&&this.container.remove(),this.hightlightSection=s,this.initContainer(this.hightlightSection)),this.container&&!s||this.initContainer(s),this.show()}}),webextApi.runtime.connect().onDisconnect.addListener(()=>{this.hide(),document.body.setAttribute("wotDisconnected","true")})}initContainer(t){this.container=document.createElement("iframe"),this.container.id=WOT_POPUP_SLIDER_IFRAME,document.body.addEventListener("click",this.autoHide.bind(this)),document.body.addEventListener("keyup",t=>{/^esc/i.test(t.key)&&this.hide()}),window.addEventListener("resize",this.autoPosition.bind(this)),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.handleLeaveCurrentTab()}),document.body.appendChild(this.container),this.container.style.width=SLIDER_WIDTH+"px",this.container.style.left=CLOSED_POSITION(),this.container.src=`${webextApi.runtime.getURL("/slider.html")}?wot_host=${window.location.hostname}&section=${t}`}handleLeaveCurrentTab(){this.isSliderOpen&&(this.isSliderOpen=!1,"safari"===browserName?this.hide():this.container.remove(),this.container=null),AddReviewHandler.closeAddReview()}show(){clearTimeout(this.hideTimeOutRef),this.showTimeOutRef=setTimeout(()=>{this.container.style.left=OPEN_POSITION(),this.isSliderOpen=!0},100)}hide(){this.container&&(clearTimeout(this.showTimeOutRef),this.container.style.left=CLOSED_POSITION(),this.container.contentWindow.postMessage("wot-close-slider-event","*"),this.isSliderOpen=!1)}autoPosition(){this.isSliderOpen&&this.show()}autoHide(t){t&&this.container&&t.target.id!==ADD_REVIEW_CONTAINER_ID&&t.clientX<this.container.offsetLeft&&this.hide()}}