const DRAG_HANDLE_HEIGHT=62,SHIELD_HEIGHT=32;class WotAssistant extends React.Component{constructor(t){super(t),this.state={isHandleVisible:!1,dragging:!1,isCurrentlyExpanded:!1,isTrackersListOpen:!1,isTrackersListTop:!1,isHovering:!1},this.isDragOn=!1,this.dragHandle=null,this.topLine=null,this.bottomLine=null,this.toggleHandleVisibility=this.toggleHandleVisibility.bind(this),this.toggleExpandedAssistantLock=this.toggleExpandedAssistantLock.bind(this),this.onTrackerListStateChange=this.onTrackerListStateChange.bind(this),this.openAddReview=this.openAddReview.bind(this),this.openSlider=this.openSlider.bind(this);const e=t.store,s=t.host,i=t.showAssistant,a=t.assistantExpandedLocked;i&&a&&e.dispatch(getCommentAndRating(s))}componentDidUpdate(){this.initDrag()}onTrackerListStateChange(t){this.setState({isTrackersListOpen:t.isOpen,isTrackersListTop:t.isTop})}toggleHandleVisibility(t,e){const s=this.props.assistantExpandedLocked,i=e.target,a=e.clientX;if(t===this.state.isHandleVisible)return;if(!t&&this.state.dragging)return;const n=window.innerWidth-a>50;t&&s&&n||(!t||e.target.className&&/handle|wot-shield/.test(i.className))&&(t&&this.props.store.dispatch(getCommentAndRating(this.props.host)),this.setState(e=>({isHandleVisible:t,isCurrentlyExpanded:t,isTrackersListOpen:e.isTrackersListOpen&&s})))}toggleExpandedAssistantLock(){const t=!this.props.assistantExpandedLocked;this.props.dispatch(setAssistantExpanded(t))}openSlider(){toggleWOTSlider()}openAddReview(){const t=this.props.store.getState().user.uid;GA("assistant","add review"),t&&this.props.store.dispatch(newReview(t,this.props.host)),window.postMessage({type:OPEN_ADD_REVIEW},"*")}initDrag(){if(!this.props.protection||!this.props.showAssistant||this.isDragOn)return;this.isDragOn=!0,this.dragHandle=document.getElementsByClassName("wot-new-assistant-handle")[0],this.shield=document.getElementsByClassName("wot-assistant-shield__container")[0];const t=document.getElementsByClassName("wot-new-assistant-line");this.topLine=t[0],this.bottomLine=t[1];let e=0,s=0;const i=window.innerHeight,a=i-62-24,n=t=>t<=a&&t>=24,o=t=>{t.preventDefault(),t.stopPropagation();const i=t.clientY-e;if(n(i)){s=i;const t=this.calculateHandlePositions(s);this.bottomLine.style.top=t.bottomLine.top,this.bottomLine.style.height=t.bottomLine.height,this.topLine.style.height=t.topLine.height,this.dragHandle.style.top=t.handle.top,this.shield.style.top=t.shield.top}},r=t=>{if(t.preventDefault(),t.stopPropagation(),document.body.removeEventListener("mousemove",o),document.body.removeEventListener("mouseup",r),n(s)){const t=Math.floor(s/(window.innerHeight/100));this.props.store.dispatch(setAssistantPosition(t))}this.setState({dragging:!1})},l=t=>{e=t.offsetY,document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",r),this.setState({isHandleVisible:!0,dragging:!0})};this.dragHandle.removeEventListener("mousedown",l),this.dragHandle.addEventListener("mousedown",l)}calculateHandlePositions(t){const e=t||window.innerHeight*(this.props.handleTop/100),s=e+62;return{topLine:{height:e+"px"},bottomLine:{top:s+"px",height:window.innerHeight-s+"px"},handle:{top:e+"px"},shield:{top:e+15+"px"}}}render(){var t=this.props;const e=t.shield,s=t.assistantExpandedLocked,i=t.trackers,a=t.showAssistant,n=t.protection;if(!a||!n)return this.isDragOn=!1,React.createElement("div",null);var o=this.state;const r=o.isHandleVisible,l=o.isCurrentlyExpanded,d=o.isTrackersListOpen,c=o.isTrackersListTop,p=o.dragging,h=o.isHovering,g=s||l,m=this.calculateHandlePositions();return React.createElement("div",{className:"wot-new-assistant-container"+(p?" dragging":""),onMouseLeave:t=>this.toggleHandleVisibility(!1,t)},React.createElement("div",{className:"wot-assistant-shield__container"+(p?" dragging":""),style:m.shield,onMouseOver:t=>this.toggleHandleVisibility(!0,t),onFocus:t=>this.toggleHandleVisibility(!0,t)},React.createElement("div",{className:"wot-new-assistant-line disappearing"+(r?"":" invisible"),style:m.topLine}),React.createElement("div",{className:`wot-new-assistant-handle disappearing${p?" dragging":""}${r?"":" invisible"}`,style:m.handle}),React.createElement("div",{className:"wot-new-assistant-line disappearing"+(r?"":" invisible"),style:m.bottomLine}),React.createElement(LottieAnimation,{className:"assistant-lock__icon"+(p?" dragging":""),animationName:"assistant_lock.json",autoplay:!1,loop:!1,lastFrame:s,onClick:this.toggleExpandedAssistantLock}),React.createElement("div",{className:`wot-assistant-expanding-wrapper${g?" expanded":""}\n                        ${l?" hovered":""}${d?" trackers-open":""}${c?" trackers-below":""}`},React.createElement("div",{className:"wot-assistant-full-size-wrapper"+(h?" no-borders":""),onMouseMove:()=>this.setState({isHovering:!0}),onMouseLeave:()=>this.setState({isHovering:!1})},React.createElement("div",{title:translate("assistantSliderButtonTitle"),className:"wot-assistant-full-size-part"},React.createElement("div",{className:"wot-assistant-icon-container wot-shield no-filter"},React.createElement(LottieAnimation,{className:"assistant-shield__icon",onClick:this.openSlider,animationName:e,autoplay:!1,loop:!1,lastFrame:g}))),React.createElement("div",{className:"wot-assistant-full-size-part trackers-btn"+(d?" trackers-open":"")},React.createElement(AssistantTrackersData,{trackers:i,assistantLocation:m.handle.top,assistantExpanded:g,onListStateChange:this.onTrackerListStateChange})),React.createElement("div",{title:translate("assistantReviewButtonTitle"),className:"wot-assistant-full-size-part"},React.createElement(SvgIcon,{className:"wot-assistant-icon-container write-review",svg:"write-review-blue.svg",onClick:this.openAddReview}))))))}}function getTrackers(t,e){const s=e.history,i=e.allowList;return s.reduce((e,s)=>(s.initiator===t&&e.push({name:s.name,isBlocked:!i[s.name]}),e),[])}function mapStateToProps(t){const e=window.location.hostname.replace(/^www\d*\./,"");return{showAssistant:t.user.isPremiumUser&&t.settings.assistant,host:e,shield:`shield_${t.ratings[e]?t.ratings[e].safety:UNKNOWN}.json`,handleTop:t.settings.assistantHandleTop||48,assistantExpandedLocked:t.settings.assistantExpanded,trackers:getTrackers(e,t.trackerBlockerData),protection:t.settings.protection}}WotAssistant=ReactRedux.connect(mapStateToProps)(WotAssistant);