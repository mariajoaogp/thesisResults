var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t};const MOBILE_HEADER_STARTING_POINT=147,darkUpgradeToast={bodyClassName:"dark-toast-body",iconClassName:"premium-diamond",timelineClassName:"dark-toast-timeline",titleClassName:"dark-toast-title",moreTextClassName:"dark-toast-more-text",titleText:"premiumFeature",actionText:"unlockPremium"},lightReviewToast={bodyClassName:"light-toast-body",titleClassName:"light-toast-title",moreTextClassName:"light-toast-more-text"};class SliderMainComponent extends React.Component{constructor(t){super(t),this.contentArea=null,this.sections={trackers:{name:"trackers",scrollPosition:500}},this.tabs={scoreCard:{title:"scoreCard",icon:"scoreCard-shield-icon",leftPos:"0"},reviews:{title:"reviews",icon:"reviews-icon",leftPos:"50%"}},this.toastsTypes={upgradeBlockAllTrackers:{props:_extends({},darkUpgradeToast,{moreText:"blockMoreTrackerBlockingOnlyPremium"}),action:this.upgradeFromToast,utmSource:"block_all",gaAction:"block all"},upgradeBlockMoreTrackers:{props:_extends({},darkUpgradeToast,{moreText:"unlimitedTrackerBlockingOnlyPremium"}),action:this.upgradeFromToast,utmSource:"block_limit",gaAction:"block all"},reviewAddedOK:{props:_extends({},lightReviewToast,{iconClassName:"notification-light-icon-ok",timelineClassName:"light-toast-timeline-ok",titleText:"reviewAddedOKTitle",moreText:"reviewAddedOKText"}),action:()=>{}},reviewAddedError:{props:_extends({},lightReviewToast,{iconClassName:"notification-light-icon-error",timelineClassName:"light-toast-timeline-error",titleText:"reviewAddedErrorTitle",moreText:"reviewAddedErrorText",actionText:"tryAgain",actionClassName:"notification-light-action"}),action:this.resendReview}},this.initState(),this.needShareRating=!0,this.isMobile=window.innerWidth<=MOBILE_BREAK_POINT_WIDTH||window.innerHeight<=MOBILE_BREAK_POINT,this.showModal=this.showModal.bind(this),this.onTabSwitch=this.onTabSwitch.bind(this),this.showToast=this.showToast.bind(this),this.closeModal=this.closeModal.bind(this),this.onToastClose=this.onToastClose.bind(this),this.showNotification=this.showNotification.bind(this),this.toggleMenu=this.toggleMenu.bind(this)}componentDidMount(){this.setBodyWidth(),this.setLoadErrorCheckTimer(),this.initToastNotificationsListener(),window.addEventListener("message",t=>{"wot-close-slider-event"===t.data&&this.setState({selectedTabName:this.tabs.scoreCard.title})}),this.contentArea=document.getElementsByClassName("slider-content-area")[0],this.props.section&&(this.contentArea.scrollTop=this.sections[this.props.section].scrollPosition)}componentDidUpdate(t){t.info.comments.loading!==this.props.info.comments.loading&&this.checkMobile()}onTabSwitch(t){this.setState({selectedTabName:t}),this.contentArea.scrollTo(0,0)}onToastClose(t){if(t){const t=this.state.toast;return t.action(t)}this.setState({toast:null})}onAdultRedStripeClick(){let t=this.getAdultLabel();var e=this.props;const s=e.user,i=e.settings,o=e.info;if(s.isPremiumUser)if(i.parental){const t=this.isHostWhitelisted(o.host)?removeFromWhitelist:addToWhitelist;this.props.store.dispatch(t(o.host))}else this.props.store.dispatch(turnOnParentalControl());else t+="_upgrade",webextApi.runtime.sendMessage({name:OPEN_TAB_MESSAGE,url:UPGRADE_LP+"?utm_source=Ext_Adult"});GA(GA_MAIN_CATEGORY,"Adult Strip",t)}setIsAdultWarning(){const t=this.props.info,e=t.categories.map(t=>t.group),s=t.childSafety===NOT_SAFE||e.includes("adult"),i=e.includes("gambling"),o=s||i;return o&&setTimeout(()=>{document.querySelectorAll(".slider-adult-warning-movement").forEach(t=>{t.style.top="0"})},10),o}setBodyWidth(){if(this.isMobile){document.getElementById(WOT_POPUP_SLIDER_CONTAINER).style.width="100vw"}}setLoadErrorCheckTimer(){clearTimeout(this.checkLoadErrTimer),this.checkLoadErrTimer=setTimeout(()=>{!this.props.info.loaded&&this.setState(t=>_extends({},t,{isLoadingError:!0}))},5e3)}getAdultLabel(){var t=this.props;const e=t.user,s=t.settings;return e.isPremiumUser&&s.parental?this.isHostWhitelisted(this.props.info.host)?"block":"whitelist":"block"}getExtraClass(t){switch(t){case"whatsNew":return"modal-whats-new";default:return""}}closeModal(){"rating"===this.state.modalToShow?GA(GA_MAIN_CATEGORY,"Rate Us Close"):"mobile"===this.state.modalToShow&&(this.props.dispatch(mobileTrigerModalReset()),GA(GA_MAIN_CATEGORY,"Mobile Popup Close"));const t=document.getElementsByClassName("modal-window")[0];t&&(t.style.transition="opacity ease 200ms",t.style.opacity="0"),setTimeout(()=>{this.setState({modalToShow:null})},300)}showNotification(){this.setState({notification:!0})}closeNotification(){const t=document.getElementsByClassName("wot-popup-notification")[0];t&&t.classList.remove("wot-popup-notification_open"),setTimeout(()=>{this.setState({notification:!1})},200)}showModal(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("ratingSharing"===t){if(!this.needShareRating)return;this.needShareRating=!1}return()=>{this.setState({modalToShow:t,attr:e})}}toggleMenu(t){this.setState({openMenu:t})}initState(){let t=null;switch(!0){case this.IsShowWhatsNew():t="whatsNew"}this.state={modalToShow:t,isAdultWarning:this.setIsAdultWarning(),notification:!1,toast:null,selectedTabName:this.tabs.scoreCard.title,openMenu:!1}}isNeedShowSurveyModal(){const t=this.props.store.getState().survey;return!t.isShowed&&(new Date).getTime()-t.installDate>SURVEY_SHOW_DELAY}resendReview(){this.props.store.dispatch(saveCommentAndReview())}upgradeFromToast(t){goUpgrade(GA_MAIN_CATEGORY,t.gaAction+" free",t.utmSource)}isHostWhitelisted(t){return this.props.store.getState().whitelist.includes(t)}checkMobile(){this.isMobile&&setTimeout(()=>{const t=document.getElementsByClassName("rating-flow-scroll")[0];t&&t.scrollTo(0,147)},1)}initToastNotificationsListener(){webextApi.runtime.onMessage.addListener(t=>{const e=t.action,s=t.notification;e===SHOW_TOAST_NOTIFICATION&&this.setState({toast:this.toastsTypes[s]})})}IsShowWhatsNew(){return!!this.props.store.getState().version.showWhatsNew&&(this.props.store.dispatch(setShowWhatsNew(!1)),!0)}showToast(t){this.setState({toast:this.toastsTypes[t]})}render(){webextApi.runtime.sendMessage({name:OPEN_POPUP});var t=this.state;const e=t.modalToShow,s=t.isAdultWarning,i=t.toast,o=t.selectedTabName,a=t.openMenu;var n=this.props;const r=n.info,l=n.section,c=this.getAdultLabel();return React.createElement("div",{className:"main-popup-container "+(a?" menu-open":"")},React.createElement("div",{className:"slider-menu-background"}),React.createElement(SliderHeader,{info:r,comments:r.comments,store:this.props.store,showModal:this.showModal,tabs:this.tabs,selectedTab:o,switchTab:this.onTabSwitch,toggleMenu:this.toggleMenu}),React.createElement("span",{className:"slider-content-area"+(s?" slider-adult-warning-movement":"")},React.createElement("div",{className:"scroll-placeholder"}),s&&React.createElement("div",{className:"slider-adult-warning"},React.createElement("div",{className:"slider-adult-warning-title"},translate("containAdultContent")),React.createElement("div",{className:"slider-adult-warning-button",onClick:this.onAdultRedStripeClick.bind(this)},translate(c))),o===this.tabs.scoreCard.title&&React.createElement("span",null,React.createElement(RateUs,{store:this.props.store,user:this.props.user,onClose:this.closeRateUs}),React.createElement(SliderBody,{info:r,store:this.props.store,isAdultWarning:s}),React.createElement(SliderTrackerMain,{store:this.props.store,showToast:this.showToast,blink:l===this.sections.trackers.name})),o===this.tabs.reviews.title&&React.createElement(SliderReviews,{info:r,store:this.props.store}),e&&React.createElement(ModalMessage,{onClose:this.closeModal,showModal:this.showModal,showNotification:this.showNotification,modalType:e,className:"modal-message "+this.getExtraClass(e),store:this.props.store,host:r.host,reviews:r.reviews}),this.state.notification&&React.createElement(Notification,{onClose:this.closeNotification})),React.createElement(SliderFooter,null),i&&React.createElement(SliderToast,{toastProps:i.props,close:this.onToastClose}))}}function mapStateTpPros(t){const e=t.currentTab,s=e&&getEncodedDomain(e.url),i=e&&e.favIconUrl||GET_FAVICON_PREFIX+s,o=t.ratings&&t.ratings[s]?t.ratings[s]:{};return{info:{rating:o.rating>0?o.rating:"",confidence:o.confidence||"",categories:o.categories||[],childSafety:o.childSafety||"",loaded:!!t.ratings[s],comments:_extends({},t.comments[s],{loading:t.comments.loading}),safety:t.ratings[s]?t.ratings[s].safety:UNKNOWN,host:s||"not host",iconColor:getShieldColor(t.ratings[s]).color,reviews:t.reviews[t.user&&t.user.uid||1]&&t.reviews[t.user&&t.user.uid||1][s],experimentalFeature:t.experimentalFeature.status,faviconUrl:i},user:{isPremiumUser:t.user.isPremiumUser},settings:t.settings}}SliderMainComponent.propTypes={},SliderMainComponent=ReactRedux.connect(mapStateTpPros)(SliderMainComponent);